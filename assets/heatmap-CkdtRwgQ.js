import{_ as Qe,r as C,a as Xe,c as E,q as ae,o as Ze,d as p,f as a,g as F,F as le,j as ce,w as J,v as Je,l as et,s as Me,e as $e,t as w,i as de,m as xe,n as ue,h as m,x as tt,p as Te}from"./index-DsGwuyBr.js";import{i as he}from"./index-ClPwX7rX.js";const ot={class:"graph-container"},st={class:"sidebar left"},nt=["onClick","title"],rt={class:"node-label"},it={key:0,class:"dot"},at={class:"hover-actions"},lt=["onClick"],ct=["onClick"],dt={class:"main-content"},ut={key:0,class:"cluster-list-container"},ht={class:"cluster-list-header"},ft={class:"filter-controls"},gt={class:"search-controls"},pt={class:"search-box"},mt={class:"toggle-controls"},vt={class:"toggle"},wt={class:"filter-sort-controls"},yt={class:"cluster-list"},_t=["onClick","onMouseover"],Ct={class:"cluster-header"},bt={class:"cluster-title"},Nt={class:"cluster-count"},St={class:"cluster-summary"},kt={class:"cluster-meta"},Mt={class:"cluster-links"},$t={class:"cluster-weight"},xt={key:0,class:"no-results"},Tt={key:1,class:"chart-container"},It={class:"chart-header"},Lt={class:"sidebar right"},zt={class:"node-detail"},Dt={key:0},Wt=["href"],Et={key:1},Ft={class:"node-time"},Ot={key:0,class:"summary-text"},Rt={key:1,class:"cluster-stats"},Bt={key:1},At={class:"related-section"},Vt=["onClick"],jt={class:"related-header"},Ht=["href"],Ut={key:1,class:"related-title"},Gt={class:"weight-info"},Yt={class:"weight-bar"},Pt={class:"weight-text"},qt={class:"mini-chart-container"},Ie=8,Kt={__name:"heatmap",setup(Qt){let ee=[];const te=C(null),fe=C(null);let u=null,b=null,y=[],M=[];const P=C(""),oe=C(!1),q=C(""),se=C({x:0,y:0}),ge=C([]),O=C("all"),R=C("default"),r=Xe({currentId:null,pathNodes:[],pathLinks:new Set,derived:{},fadedNodes:new Set,isInClusterMode:!1,currentClusterId:null}),N=C(null),ne=E(()=>r.pathNodes),pe=E(()=>r.currentId);function Le(t,e){q.value=e;const o=t.target.getBoundingClientRect();se.value={x:o.right+10,y:o.top-10+window.scrollY}}function ze(){q.value=""}function De(t){return!t||!t.trim()?"":t.trim()}function K(t){return t?De(String(t)).toLowerCase().trim().replace(/[\s\-_]+/g,"").replace(/[^\w\u4e00-\u9fa5]/g,""):""}function me(t,e){if(!t||!e)return!1;const o=K(t),s=K(e);return!o||!s?!1:s.includes(o)}function ve(t,e){if(!t||!e)return!1;const o=K(t),s=K(e);if(!o||!s)return!1;const n=We(o,s),i=Ee(o.length);return n>=i}function We(t,e){let o=0,s=0;for(let n=0;n<t.length;n++){const i=t[n];for(let l=s;l<e.length;l++)if(e[l]===i){o++,s=l+1;break}}return o/t.length}function Ee(t){return t<2?1:t<=4?.6:.5}function we(){}function B(t){if(!t)return"æœªçŸ¥æ—¥æœŸ";try{const e=new Date(t);if(isNaN(e.getTime())){const i=t.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/);if(i){const[l,c,d,f]=i;return`${c}-${d.padStart(2,"0")}-${f.padStart(2,"0")}`}return t}const o=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${o}-${s}-${n}`}catch{return t}}function I(t){if(!t)return"æœªçŸ¥æ—¶é—´";try{let e;if(t.includes("T")){if(e=new Date(t),isNaN(e.getTime())){const d=t.replace("Z","").split("T");return d.length===2?`${d[0]} ${d[1].substring(0,8)}`:t}const o=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0"),c=String(e.getSeconds()).padStart(2,"0");return`${o}-${s}-${n} ${i}:${l}:${c}`}else return B(t)}catch(e){return console.warn("æ—¶é—´æ ¼å¼åŒ–é”™è¯¯:",t,e),t}}function Fe(t){const e=new Map;y.forEach(s=>{if(s.time){const n=new Date(s.time);e.set(s.id,isNaN(n.getTime())?null:n)}});const o=t.map(s=>{const n=e.get(s.source),i=e.get(s.target);let l=s.source,c=s.target,d="unknown",f="æ—¶é—´æœªçŸ¥",A=null,V=null;return n&&i&&!isNaN(n.getTime())&&!isNaN(i.getTime())?n<i?(l=s.source,c=s.target,d="forward",A=s.source,V=s.target,f=`${B(s.source)} â†’ ${B(s.target)}`):n>i?(l=s.target,c=s.source,d="reverse",A=s.target,V=s.source,f=`${B(s.target)} â†’ ${B(s.source)}`):(l=s.source,c=s.target,d="same",f="åŒæ—¶å‘ç”Ÿ"):(d="unknown",f="æ—¶é—´ä¿¡æ¯ä¸è¶³"),{...s,source:l,target:c,time_direction:d,direction_label:f,original_source:s.source,original_target:s.target,early_node:A,late_node:V}});return console.log("åŸºäºæ—¶é—´è®¡ç®—çš„é“¾æ¥æ–¹å‘(æ—©â†’æ™š):",o),o}function Oe(t,e){return Math.round(Math.abs((t-e)/864e5))<=7&&t<=e}function Re(t,e,o){return Math.round(Math.abs((t-e)/864e5))<=o&&t<=e}function Be(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()}function Ae(t,e,o){const s=new Date(e);return s.setMonth(s.getMonth()-o),t>=s&&t<=e}function ye(t){const e=t.match(/(\d{4}-\d{2}-\d{2})/g);if(!e||e.length===0)return null;const o=new Date(e[e.length-1]);return isNaN(o.getTime())?null:o}function _e(t,e,o="desc"){const s=ye(t.summary),n=ye(e.summary);return!s&&!n?0:s?n?o==="desc"?n.getTime()-s.getTime():s.getTime()-n.getTime():o==="desc"?-1:1:o==="desc"?1:-1}const Ve=E(()=>r.isInClusterMode&&r.currentClusterId?window.__clusterCache?.get(r.currentClusterId)?.summary||"ä¸»é¢˜ç°‡è¯¦æƒ…":"æ–°é—»å…³è”å›¾è°±"),Ce=E(()=>{let t=ge.value;const e=P.value.trim();if(e&&(e.toLowerCase(),t=t.filter(o=>{const s=o.name.toLowerCase(),n=o.summary.toLowerCase();return oe.value?ve(e,s)||ve(e,n):me(e,s)||me(e,n)})),O.value!=="all"){const o=new Date;t=t.filter(s=>{const n=s.summary.match(/(\d{4}-\d{2}-\d{2})/g);if(!n||n.length===0)return!0;const i=new Date(n[n.length-1]);if(isNaN(i.getTime()))return!0;switch(O.value){case"week":return Oe(i,o);case"10days":return Re(i,o,10);case"month":return Be(i,o);case"3months":return Ae(i,o,3);default:return!0}})}return R.value!=="default"&&(t=[...t].sort((o,s)=>{switch(R.value){case"timeDesc":return _e(o,s,"desc");case"timeAsc":return _e(o,s,"asc");case"nodesDesc":return s.nodeCount-o.nodeCount;case"nodesAsc":return o.nodeCount-s.nodeCount;default:return 0}})),t});function be(t){if(t.startsWith("super")){const o=window.__clusterCache?.get(t);return o?o.summary||"ä¸»é¢˜ç°‡":ee.find(n=>n.id===t)?.name||"ä¸»é¢˜ç°‡"}const e=y.find(o=>o.id===t);return e&&e.title||t}function D(t){if(!t)return"";if(t.length<=8||t.length<=15)return t;const e=t.substring(0,8),o=t.substring(8,15);return e+`
`+o+"..."}const S=E(()=>{const t=N.value||r.currentId;if(console.log("Display node ID:",t,"Hover:",N.value,"Current:",r.currentId),!t)return null;if(t.startsWith("super")){const o=window.__clusterCache?.get(t);if(o){ee.find(l=>l.id===t);const s=o.nodes.map(l=>l.time).filter(l=>l).sort();let n="æ—¶é—´æœªçŸ¥";if(s.length>0){const l=s[0],c=s[s.length-1];l===c?n=`å‘å¸ƒæ—¶é—´: ${I(l)}`:n=`æ—¶é—´èŒƒå›´: ${I(l)} - ${I(c)}`}const i={id:t,title:o.summary||"ä¸»é¢˜ç°‡",summary:`åŒ…å« ${o.nodes.length} ä¸ªç›¸å…³èŠ‚ç‚¹ï¼Œ${o.links.length} æ¡å…³è”`,time:n,url:null,isSuper:!0};return console.log("Super node display:",i),i}}const e=y.find(o=>o.id===t);return e?{...e,time:I(e.time)}:(console.log("Found node:",e),e)}),je=E(()=>{const t=N.value||r.currentId;if(console.log("Getting related nodes for:",t,"Cluster mode:",r.isInClusterMode,"Current cluster:",r.currentClusterId),r.isInClusterMode&&r.currentClusterId&&(!t||t===r.currentClusterId)){const n=window.__clusterCache.get(r.currentClusterId);if(n)return console.log("Showing all cluster nodes on cluster entry:",n.nodes.length,"nodes"),n.nodes.map(i=>({...i,weight:1}))}if(!t)return[];if(t.startsWith("super")){const n=window.__clusterCache?.get(t);if(n)return console.log("Found cluster cache for super node:",n.nodes.length,"nodes"),n.nodes.map(i=>({...i,weight:1}))}let e=[];if(r.isInClusterMode){const n=window.__clusterCache.get(r.currentClusterId);if(n){const i=new Set(n.nodes.map(l=>l.id));n.links.forEach(l=>{if(l.source===t&&i.has(l.target)){const c=n.nodes.find(d=>d.id===l.target);c&&e.push({...c,weight:l.weight||0})}})}}else M.forEach(n=>{if(n.source===t){const i=y.find(l=>l.id===n.target);i&&e.push({...i,weight:n.weight||0})}});console.log("Found neighbors:",e.length);const o=[],s=new Set;return e.forEach(n=>{s.has(n.id)||(s.add(n.id),o.push(n))}),r.isInClusterMode?o.sort((n,i)=>i.weight-n.weight):o.sort((n,i)=>i.weight-n.weight).slice(0,Ie)});function Ne(t,e=Ie,o=.2){const s=M.filter(n=>n.source===t).map(n=>({...n,other:n.target,weight:n.weight||0})).filter(n=>n.weight>=o).sort((n,i)=>i.weight-n.weight).slice(0,e);return console.log(`Top ${e} neighbors for ${t}:`,s),s.map(n=>n.other)}C(new Map),C(!1);function re(t,e){if(!t)return;const{nodes:o,links:s}=t,n=new Set(y.map(c=>c.id)),i=o.filter(c=>n.has(c.id)),l=s.filter(c=>n.has(c.source)&&n.has(c.target));if(r.isInClusterMode=!0,r.currentClusterId=e,!r.pathNodes.includes(e)){const c=r.pathNodes[r.pathNodes.length-1];c&&r.pathLinks.add(`${c}-${e}`),r.pathNodes.push(e)}r.currentId=e,ue(()=>{u||(u=he(te.value)),u.clear(),u.setOption({tooltip:{show:!0,trigger:"item",formatter:d=>{if(d.dataType==="node"){const f=d.data;return`
              <div style="padding: 8px; max-width: 300px; word-wrap: break-word; overflow-wrap: break-word;">
                <div style="font-weight: bold; margin-bottom: 4px; color: #2c3e50; white-space: normal;">${f.title||f.name||f.id}</div>
                ${f.summary?`<div style="color: #666; font-size: 12px; line-height: 1.4; white-space: normal; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">${f.summary}</div>`:""}
                ${f.time?`<div style="color: #999; font-size: 11px; margin-top: 4px;">ğŸ•’ ${f.time}</div>`:""}
              </div>
            `}return""},backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#ddd",borderWidth:1,textStyle:{color:"#333"},confine:!0,extraCssText:"max-width: 320px; word-break: break-word;"},animationDurationUpdate:500,series:[{type:"graph",layout:"force",force:{repulsion:260,gravity:.05,edgeLength:[80,180]},data:i.map(d=>({...d,name:D(d.name||d.title||d.id),symbolSize:50,itemStyle:{color:d.id===e?"#27ae60":"#3498db"},label:{show:!0,position:"inside",fontSize:10,color:"#111",fontWeight:"bold",backgroundColor:"transparent",borderColor:"transparent",borderWidth:0,borderRadius:0,padding:0,lineHeight:15,formatter:function(f){return D(f.data.title||f.data.name||f.data.id)}},emphasis:{scale:!0,itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}})),links:l.map(d=>({...d,symbol:["none","arrow"],symbolSize:[0,8],lineStyle:{width:2,color:"#888",opacity:.9}})),roam:!0,draggable:!0,emphasis:{focus:"none",scale:!0}}]},{replaceMerge:["series"]}),u.resize();function c(){u.off("finished",c),Q(e)}u.on("finished",c),u.off("click"),u.on("click",d=>{d.dataType==="node"&&(console.log("Cluster chart click:",d.data.id),x(d.data.id))}),u.off("mouseover"),u.on("mouseover",d=>{d.dataType==="node"&&(console.log("Cluster mouse over:",d.data.id),N.value=d.data.id,r.currentId=d.data.id)}),u.off("mouseout"),u.on("mouseout",()=>{console.log("Cluster mouse out"),N.value=null,r.currentId=r.pathNodes[r.pathNodes.length-1]||null})}),$()}function He(t){if(!t)return;console.log("Deriving neighbors for:",t),r.derived[t]||(r.derived[t]=[]);const e=new Set([...r.pathNodes]);for(const n in r.derived)(r.derived[n]||[]).forEach(i=>e.add(i));const s=Ne(t).filter(n=>!e.has(n)).filter(n=>M.some(i=>i.source===t&&i.target===n));console.log("Valid candidates:",s),s.length&&r.derived[t].push(...s),X(t)}function Ue(t=r.currentId){const e=new Set([...r.pathNodes]);for(const s of r.pathNodes)(r.derived[s]||[]).forEach(n=>e.add(n));const o=new Set;t&&(o.add(t),(r.derived[t]||[]).forEach(s=>o.add(s))),r.fadedNodes=new Set,e.forEach(s=>{o.has(s)||r.fadedNodes.add(s)})}function Ge(t){return t===r.currentId?"#e74c3c":r.pathNodes.includes(t)?"#27ae60":(r.currentId,"#bfdbfe")}function Ye(){const t=[];for(const e of r.pathNodes)(r.derived[e]||[]).forEach(o=>t.push({source:e,target:o}));return t.map(e=>({...e,symbol:["none","arrow"],symbolSize:[0,8],lineStyle:{width:r.pathLinks.has(`${e.source}-${e.target}`)?3:2,color:r.pathLinks.has(`${e.source}-${e.target}`)?"#e74c3c":"#888",opacity:.9,transition:"opacity 0.3s"}}))}function Q(t){if(!u||!t)return;const e=u.getModel().getSeriesByIndex(0);if(!e)return;const o=e.getData();if(!o||typeof o.indexOfRawData!="function")return;const s=o.indexOfRawData(t);if(s==null||s<0)return;const n=o.getItemLayout(s);if(!n)return;const i=u.getWidth()/2-n[0],l=u.getHeight()/2-n[1];u.dispatchAction({type:"graphRoam",dx:i,dy:l})}function X(t){u||(u=he(te.value)),Ue(t);let e=Ye();t||(e=M.sort((o,s)=>(s.weight||0)-(o.weight||0)).slice(0,50).map(o=>({...o,symbol:["none","arrow"],symbolSize:[0,8],lineStyle:{width:2,color:"#888",opacity:.8}}))),u.clear(),u.setOption({tooltip:{show:!0,trigger:"item",formatter:o=>{if(o.dataType==="node"){const s=o.data;return`
            <div style="padding: 8px; max-width: 300px; word-wrap: break-word; overflow-wrap: break-word;">
              <div style="font-weight: bold; margin-bottom: 4px; color: #2c3e50; white-space: normal;">${s.title||s.name||s.id}</div>
              ${s.summary?`<div style="color: #666; font-size: 12px; line-height: 1.4; white-space: normal; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">${s.summary}</div>`:""}
              ${s.time?`<div style="color: #999; font-size: 11px; margin-top: 4px;">ğŸ•’ ${s.time}</div>`:""}
            </div>
          `}return""},backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#ddd",borderWidth:1,textStyle:{color:"#333"},confine:!0,extraCssText:"max-width: 320px; word-break: break-word;"},animationDurationUpdate:500,series:[{type:"graph",layout:"force",data:y.map(o=>({...o,name:D(o.title||o.name||o.id),symbolSize:o.symbolSize||40,itemStyle:{color:Ge(o.id),opacity:1},label:{show:!0,position:"inside",fontSize:10,color:"#888",fontWeight:"bold",backgroundColor:"transparent",borderColor:"transparent",borderWidth:0,borderRadius:0,padding:0,lineHeight:15,formatter:function(s){return D(s.data.title||s.data.name||s.data.id)}},emphasis:{scale:!0,itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}})),links:e,roam:!0,draggable:!0,emphasis:{focus:"none",scale:!0},force:{repulsion:500,gravity:.08,edgeLength:[100,200]},focusNodeAdjacency:!1}]}),u.resize(),u.off("mouseover"),u.on("mouseover",o=>{o.dataType==="node"&&(console.log("Mouse over node:",o.data.id),N.value=o.data.id,r.currentId=o.data.id)}),u.off("mouseout"),u.on("mouseout",()=>{console.log("Mouse out"),N.value=null,r.currentId=r.pathNodes[r.pathNodes.length-1]||null}),u.off("click"),u.on("click",o=>{o.dataType==="node"&&(console.log("Click node:",o.data.id),x(o.data.id))})}function $(){b||(b=he(fe.value));const t=N.value||r.currentId;let e=[],o=[];if(!t){b.clear(),b.setOption({title:{text:"è¯·é€‰æ‹©èŠ‚ç‚¹æŸ¥çœ‹å…³è”",left:"center",top:"center",textStyle:{color:"#999",fontSize:14}},series:[]});return}if(r.isInClusterMode&&t&&!t.startsWith("super")){const s=window.__clusterCache.get(r.currentClusterId);if(s){const n=new Set(s.nodes.map(l=>l.id)),i=s.nodes.find(l=>l.id===t);if(i){e=[i];const l=new Set;s.links.forEach(c=>{c.source===t&&n.has(c.target)&&(l.add(c.target),o.push({source:c.source,target:c.target,symbol:["none","arrow"],symbolSize:[0,6],lineStyle:{width:1.5,color:"#888",opacity:.9}}))}),l.forEach(c=>{const d=s.nodes.find(f=>f.id===c);d&&e.push(d)})}}}else if(t&&t.startsWith("super")){const s=window.__clusterCache?.get(t);s&&(e=s.nodes,o=s.links.map(n=>({...n,symbol:["none","arrow"],symbolSize:[0,6],lineStyle:{width:1.5,color:"#888",opacity:.9}})))}else{const s=y.find(n=>n.id===t);if(s){e=[s];const n=new Set;M.forEach(i=>{i.source===t&&(n.add(i.target),o.push({source:i.source,target:i.target,symbol:["none","arrow"],symbolSize:[0,6],lineStyle:{width:1.5,color:"#888",opacity:.9}}))}),n.forEach(i=>{const l=y.find(c=>c.id===i);l&&e.push(l)})}}if(e.length<=1){b.clear(),b.setOption({title:{text:"è¯¥èŠ‚ç‚¹æ²¡æœ‰ç›´æ¥å…³è”èŠ‚ç‚¹",left:"center",top:"center",textStyle:{color:"#999",fontSize:14}},series:[]});return}b.clear(),b.setOption({tooltip:{show:!0,formatter:s=>s.dataType==="node"?s.data.title||s.data.name||s.data.id:""},series:[{type:"graph",layout:"force",data:e.map(s=>({...s,name:D(s.title||s.name||s.id),symbolSize:t&&s.id===t?45:32,itemStyle:{color:t&&s.id===t?"#e74c3c":"#3498db"},label:{show:!0,position:"inside",fontSize:9,color:"#111",fontWeight:"bold",backgroundColor:"transparent",borderColor:"transparent",borderWidth:0,borderRadius:0,padding:0,formatter:n=>D(n.data.title||n.data.name||n.data.id)}})),links:o,roam:!0,draggable:!0,force:{repulsion:150,edgeLength:[80,120],gravity:.1}}]}),b.resize(),b.off("click"),b.on("click",s=>{s.dataType==="node"&&x(s.data.id)})}function x(t){if(!t)return;if(console.log("Focusing on node:",t,"Cluster mode:",r.isInClusterMode),r.isInClusterMode){const o=r.pathNodes[r.pathNodes.length-1];o&&o!==t&&r.pathLinks.add(`${o}-${t}`),r.pathNodes.includes(t)||r.pathNodes.push(t),r.currentId=t,Pe(t),$();return}const e=r.pathNodes[r.pathNodes.length-1];e&&e!==t&&r.pathLinks.add(`${e}-${t}`),r.pathNodes.includes(t)||r.pathNodes.push(t),r.currentId=t,He(t),X(t),Q(t),$()}function Pe(t){if(!u||!r.isInClusterMode||!window.__clusterCache.get(r.currentClusterId))return;const o=u.getOption(),s=o.series[0];s.data=s.data.map(n=>{const i={...n.itemStyle};return n.id===t?i.color="#e74c3c":r.pathNodes.includes(n.id)?i.color="#27ae60":i.color="#3498db",{...n,itemStyle:i}}),u.setOption(o)}function qe(t){if(t<0||t>=r.pathNodes.length-1)return;const e=r.pathNodes[t],o=e.startsWith("super");r.pathNodes=r.pathNodes.slice(0,t+1),r.currentId=e;const s=new Set;for(let i=0;i<r.pathNodes.length-1;i++)s.add(`${r.pathNodes[i]}-${r.pathNodes[i+1]}`);if(r.pathLinks=s,o){const i=window.__clusterCache.get(e);if(i){r.isInClusterMode=!0,r.currentClusterId=e,re(i,e);return}}if(r.isInClusterMode&&!o){r.isInClusterMode=!1,r.currentClusterId=null,ue(()=>{X(e),Q(e),$(),Z()});return}const n=new Set(r.pathNodes);for(const i in r.derived)n.has(i)?r.derived[i]=r.derived[i].filter(l=>n.has(l)||Ne(i).includes(l)):delete r.derived[i];r.pathNodes.length===0?Se():(X(r.currentId),Q(r.currentId),Z())}function Se(){r.currentId=null,r.pathNodes=[],r.pathLinks=new Set,r.derived={},r.fadedNodes=new Set,r.isInClusterMode=!1,r.currentClusterId=null,P.value="",O.value="all",R.value="default",ue(()=>{u&&(u.dispose(),u=null),$(),Z()})}function Z(){u&&(u.off("click"),u.on("click",t=>{if(console.log("Chart click:",t,"Cluster mode:",r.isInClusterMode),t.dataType==="node"){const e=t.data.id;if(r.isInClusterMode)x(e);else if(e.startsWith("super")){const o=window.__clusterCache.get(e);o&&re(o,e)}else x(e)}}))}return ae(N,()=>{$()}),ae(pe,()=>{$()}),ae(()=>r.isInClusterMode,()=>{$()}),Ze(async()=>{const e=await(await fetch("/news_graph_causal.json")).json();window.__clusterSummaries=e.cluster_summaries||{},y=e.force_graph.nodes.sort((h,g)=>(g.time||"").localeCompare(h.time||""));const o=new Set(y.map(h=>h.id)),s=e.force_graph.links.filter(h=>o.has(h.source)&&o.has(h.target));M=Fe(s);const n=y.find(h=>h.type==="summary"||h.id==="summary_global");!!n&&(n.symbolSize=60,n.itemStyle={color:"#FFD700",borderColor:"#fff",borderWidth:2});const l=[],c=[],d=new Map;Object.entries(window.__clusterSummaries).forEach(([h,g],j)=>{if(!g.node_ids||g.node_ids.length<2)return;const H=`super_${j}`,_=g.node_ids,W=y.filter(v=>_.includes(v.id)),U=M.filter(v=>_.includes(v.source)&&_.includes(v.target));l.push({id:H,name:g.summary||`AIæ–°é—»é›†ç¾¤ ${j}`,isSuper:!0,innerIds:_,symbolSize:50+Math.min(_.length*2,30),category:j,summary:g.summary||`åŒ…å« ${_.length} ä¸ªç›¸å…³æ–°é—»èŠ‚ç‚¹`});const k=M.filter(v=>_.includes(v.source)&&!_.includes(v.target)||!_.includes(v.source)&&_.includes(v.target)),T=new Map;k.forEach(v=>{let G;_.includes(v.source)?G=v.target:G=v.source;let Y=null;if(Object.entries(window.__clusterSummaries).forEach(([L,z])=>{L!==h&&z.node_ids.includes(G)&&(Y=`super_${Object.keys(window.__clusterSummaries).indexOf(L)}`)}),Y){const L=`${H}-${Y}`,z=T.get(L)||{totalWeight:0,count:0};T.set(L,{totalWeight:z.totalWeight+(v.weight||1),count:z.count+1})}}),T.forEach((v,G)=>{const[Y,L]=G.split("-"),z=v.totalWeight/v.count;z>.1&&c.push({source:Y,target:L,weight:Math.round(z*100)/100})}),d.set(H,{nodes:W,links:U,summary:g.summary})});const f=new Set;M.forEach(h=>{f.add(h.source),f.add(h.target)});const V=y.filter(h=>f.has(h.id)).slice(0,100),Ke=new Set(V.map(h=>h.id)),ke=new Set;Object.values(window.__clusterSummaries).forEach(h=>{h.node_ids&&h.node_ids.forEach(g=>ke.add(g))});const ie=y.filter(h=>Ke.has(h.id)&&!ke.has(h.id));ee=[...ie,...l],[...M.filter(h=>ie.some(g=>g.id===h.source)&&ie.some(g=>g.id===h.target)),...c],window.__clusterCache=d,ge.value=Array.from(d.entries()).map(([h,g])=>{const j=g.nodes.length,H=g.links.length,_=g.links.length>0?(g.links.reduce((k,T)=>k+(T.weight||0),0)/g.links.length).toFixed(2):"0.00",W=g.nodes.map(k=>k.time).filter(k=>k).sort();let U="æ—¶é—´æœªçŸ¥";if(W.length>0){const k=W[0],T=W[W.length-1];k===T?U=`å‘å¸ƒæ—¶é—´: ${I(k)}`:U=`æ—¶é—´èŒƒå›´: ${I(k)} - ${I(T)}`}return{id:h,name:g.summary||"ä¸»é¢˜ç°‡",summary:U,nodeCount:j,linkCount:H,avgWeight:_,data:g}}).sort((h,g)=>g.nodeCount-h.nodeCount),r.currentId=null,r.pathNodes=[],r.pathLinks=new Set,r.derived={},r.fadedNodes=new Set,r.isInClusterMode=!1,r.currentClusterId=null,$(),Z()}),(t,e)=>(m(),p("div",ot,[a("div",st,[e[6]||(e[6]=a("h3",null,"ğŸ“‹ è·¯å¾„è®°å½•",-1)),a("button",{class:"clear-btn",onClick:Se},"ğŸ”„ å›åˆ°åˆå§‹ç•Œé¢"),a("ul",null,[(m(!0),p(le,null,ce(ne.value,(o,s)=>(m(),p("li",{key:o,class:tt({current:o===pe.value}),onClick:n=>x(o),title:be(o)},[a("span",rt,[s>0?(m(),p("span",it)):F("",!0),de(" "+w(be(o)),1)]),a("div",at,[a("button",{class:"act-btn",onClick:Te(n=>x(o),["stop"])},"ğŸ”",8,lt),ne.value.length>1&&s<ne.value.length-1?(m(),p("button",{key:0,class:"act-btn",onClick:Te(n=>qe(s),["stop"])}," â†©ï¸ ",8,ct)):F("",!0)])],10,nt))),128))])]),a("div",dt,[r.isInClusterMode?(m(),p("div",Tt,[a("div",It,[a("h2",null,w(Ve.value),1)]),a("div",{ref_key:"chartRef",ref:te,class:"chart"},null,512)])):(m(),p("div",ut,[a("div",ht,[e[11]||(e[11]=a("div",{class:"header-title"},[a("h2",null,"AIæ–°é—»å…³ç³»ç½‘ç»œå›¾è°±"),a("p",{class:"subtitle"},"æ¢ç´¢æ–°é—»ä¹‹é—´çš„å¤æ‚å…³è”ç½‘ç»œ")],-1)),a("div",ft,[a("div",gt,[a("div",pt,[J(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>P.value=o),onInput:we,placeholder:"æœç´¢ä¸»é¢˜...",class:"search-input"},null,544),[[Je,P.value]])]),a("div",mt,[a("label",vt,[J(a("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=o=>oe.value=o),onChange:we},null,544),[[et,oe.value]]),e[7]||(e[7]=a("span",{class:"toggle-slider"},null,-1)),e[8]||(e[8]=a("span",{class:"toggle-text"},"å®½æ¾åŒ¹é…",-1)),a("span",{class:"tooltip",onMouseenter:e[2]||(e[2]=o=>Le(o,"å¼€å¯åå¯æ¨¡ç³ŠåŒ¹é…ç›¸ä¼¼ä¸»é¢˜ç°‡")),onMouseleave:ze},"â”",32)])])]),a("div",wt,[J(a("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>O.value=o),class:"filter-select"},[...e[9]||(e[9]=[$e('<option value="all" data-v-86f92ac9>å…¨éƒ¨æ—¶é—´</option><option value="week" data-v-86f92ac9>æœ¬å‘¨</option><option value="10days" data-v-86f92ac9>10å¤©å†…</option><option value="month" data-v-86f92ac9>æœ¬æœˆ</option><option value="3months" data-v-86f92ac9>è¿‘ä¸‰ä¸ªæœˆ</option>',5)])],512),[[Me,O.value]]),J(a("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>R.value=o),class:"sort-select"},[...e[10]||(e[10]=[$e('<option value="default" data-v-86f92ac9>é»˜è®¤æ’åº</option><option value="timeDesc" data-v-86f92ac9>æ—¶é—´ä»æ–°åˆ°æ—§</option><option value="timeAsc" data-v-86f92ac9>æ—¶é—´ä»æ—§åˆ°æ–°</option><option value="nodesDesc" data-v-86f92ac9>èŠ‚ç‚¹æ•°ä»å¤šåˆ°å°‘</option><option value="nodesAsc" data-v-86f92ac9>èŠ‚ç‚¹æ•°ä»å°‘åˆ°å¤š</option>',5)])],512),[[Me,R.value]])])])]),a("div",yt,[(m(!0),p(le,null,ce(Ce.value,o=>(m(),p("div",{key:o.id,class:"cluster-item",onClick:s=>re(o.data,o.id),onMouseover:s=>N.value=o.id,onMouseout:e[5]||(e[5]=s=>N.value=null)},[a("div",Ct,[a("h3",bt,w(o.name),1),a("span",Nt,w(o.nodeCount)+" ä¸ªèŠ‚ç‚¹",1)]),a("p",St,w(o.summary),1),a("div",kt,[a("span",Mt,w(o.linkCount)+" æ¡å…³è”",1),a("span",$t,"å¹³å‡æƒé‡: "+w(o.avgWeight),1)])],40,_t))),128))]),Ce.value.length===0?(m(),p("div",xt," æœªæ‰¾åˆ°åŒ¹é…çš„ä¸»é¢˜ç°‡ ")):F("",!0)]))]),a("div",Lt,[a("div",zt,[e[15]||(e[15]=a("h3",null,"ğŸ“„ èŠ‚ç‚¹ä¿¡æ¯",-1)),S.value?(m(),p("div",Dt,[a("h4",null,[S.value.url?(m(),p("a",{key:0,href:S.value.url,target:"_blank",rel:"noopener"}," ğŸ“° "+w(S.value.title),9,Wt)):(m(),p("span",Et,"ğŸ“° "+w(S.value.title),1))]),a("p",Ft,"ğŸ•’ "+w(S.value.time||"æœªçŸ¥"),1),r.isInClusterMode||!S.value.isSuper?(m(),p("p",Ot,w(S.value.summary),1)):F("",!0),!r.isInClusterMode&&S.value.isSuper?(m(),p("div",Rt,[a("p",null,[e[12]||(e[12]=a("strong",null,"èŠ‚ç‚¹æ•°é‡:",-1)),de(" "+w(S.value.summary?.match(/(\d+) ä¸ªç›¸å…³èŠ‚ç‚¹/)?.[1]||"æœªçŸ¥"),1)]),a("p",null,[e[13]||(e[13]=a("strong",null,"å…³è”æ•°é‡:",-1)),de(" "+w(S.value.summary?.match(/(\d+) æ¡å…³è”/)?.[1]||"æœªçŸ¥"),1)])])):F("",!0)])):(m(),p("div",Bt,[...e[14]||(e[14]=[a("p",null,"ğŸ‘† è¯·é€‰æ‹©èŠ‚ç‚¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯",-1)])]))]),a("div",At,[e[17]||(e[17]=a("h3",null,"ğŸ”— ç›¸å…³èŠ‚ç‚¹",-1)),a("ul",null,[(m(!0),p(le,null,ce(je.value,o=>(m(),p("li",{key:o.id,onClick:s=>x(o.id),class:"related-item"},[a("div",jt,[o.url?(m(),p("a",{key:0,href:o.url,target:"_blank",rel:"noopener",class:"related-title"},w(o.title),9,Ht)):(m(),p("span",Ut,w(o.title),1))]),a("div",Gt,[a("div",Yt,[a("div",{class:"weight-fill",style:xe({width:Math.min(o.weight*25,100)+"%"})},null,4)]),a("small",Pt,"ç›¸å…³åº¦ï¼š"+w(o.weight),1)])],8,Vt))),128))]),a("div",qt,[e[16]||(e[16]=a("h4",null,"ğŸ—ºï¸ å…³è”å›¾è°±",-1)),a("div",{ref_key:"miniChartRef",ref:fe,class:"mini-chart"},null,512)])])]),q.value?(m(),p("div",{key:0,class:"hover-tip",style:xe({left:se.value.x+"px",top:se.value.y+"px"})},w(q.value),5)):F("",!0)]))}},Jt=Qe(Kt,[["__scopeId","data-v-86f92ac9"]]);export{Jt as default};
