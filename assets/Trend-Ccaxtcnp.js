import{_ as we,r as i,o as ke,d as c,f as l,g as j,i as b,F as $,j as D,w as F,v as L,k as ue,l as be,t as p,m as ie,e as Ce,h as d,p as xe}from"./index-Ga3p35v5.js";import{i as _e}from"./index-ClPwX7rX.js";const Me={class:"trend-page"},Se={class:"sidebar"},Te=["onClick"],$e={class:"count"},De={style:{"margin-top":"30px"}},Ae=["onClick"],Ee={class:"count"},Ie={class:"main"},Oe={class:"controls"},Ve={class:"toggle"},je={class:"toggle",style:{"margin-left":"12px"}},Fe={class:"hint"},Ke={class:"date-range-controls"},Ne=["min","max"],Le=["min","max"],ze={key:0,class:"suggestions",role:"listbox"},Be=["onClick","onKeydown"],Re={class:"sname"},Ue={class:"count"},Pe={key:1,class:"selected-list"},Xe=["onClick"],qe={key:2,class:"loading"},We={class:"popup-header"},Ye=["href"],He={key:1,class:"no-link"},Ze={class:"rightbar"},Ge={class:"rank-card"},Je=["onClick"],Qe={class:"count"},et={class:"rank-card"},tt=["onClick"],nt={class:"count"},ot={key:0,class:"help-popup"},lt={class:"popup-header"},ce=5,st={__name:"Trend",setup(at){const z=i(""),X=i({x:0,y:0}),q=i(!1);function A(o,e){z.value=e;const t=o.target.getBoundingClientRect();X.value={x:t.right+10,y:t.top-10+window.scrollY}}function E(){z.value=""}let M=null;async function de(){return new Promise(o=>{if(window.OpenCC)return M=OpenCC.Converter({from:"twp",to:"cn"}),o();const e=document.createElement("script");e.src="./opencc.js",e.onload=()=>{M=OpenCC.Converter({from:"twp",to:"cn"}),o()},e.onerror=()=>{console.warn("âš ï¸ OpenCC åŠ è½½å¤±è´¥ï¼Œç¹ç®€è½¬æ¢åŠŸèƒ½å·²ç¦ç”¨ã€‚"),M=null,o()},document.head.appendChild(e)})}function J(o){if(!Array.isArray(o))return[];const e={};return o.forEach(t=>{if(!t||!t.name&&!t.key)return;const n=t.name||t.key,s=k(n);s&&(e[s]=(e[s]||0)+(t.value||t.count||0))}),Object.entries(e).map(([t,n])=>({name:t,value:n})).sort((t,n)=>n.value-t.value)}function k(o){if(!o||!o.trim())return"";try{return M?M(o.trim()):o.trim()}catch{return o.trim()}}function f(o){if(!o||!o.trim())return"";try{return M?M(o.trim()):o.trim()}catch{return o.trim()}}function C(o){return o?k(String(o)).toLowerCase().trim().replace(/[\s\-_]+/g,"").replace(/[^\w\u4e00-\u9fa5]/g,""):""}function ve(o,e){if(!o||!e)return!1;const t=C(o),n=C(e);return!t||!n?!1:n.includes(t)}function pe(o,e){if(!o||!e)return!1;const t=C(o),n=C(e);if(!t||!n)return!1;const s=t.length;let v;s<=2?v=3:s<=4?v=2:s<=6?v=1:v=0;let u=0,a=0,r=0;for(;u<t.length&&a<n.length;)if(t[u]===n[a])u++,a++;else if(r++,a++,r>v)return!1;return u===t.length}const B=i(null),m=i(null),Q=i(!0),S=i([]),g=i([]),ee=i([]),W=i([]),te=i([]),ne=i([]),T=i(""),x=i([]),R=i(!1),oe=i([]),Y=i({x:0,y:0}),K=i(""),N=i(""),h=i({start:"",end:""}),H=i(!1),le=i({});function fe(o,e){if(!o||!e)return 0;const t=u=>u.toLowerCase().replace(/[\sï¼Œã€‚ï¼ï¼Ÿã€,.!?:;""""""ã€ã€‘ï¼ˆï¼‰()]/g,""),n=new Set(t(o)),s=new Set(t(e));return new Set([...n].filter(u=>s.has(u))).size/new Set([...n,...s]).size}function se(o){const e=[];for(const t of o)!t.title||!t.title.trim()||e.some(n=>fe(n.title,t.title)>.85)||e.push(t);return e}async function me(){try{const e=await(await fetch("/ai_analysis.json")).json();S.value=(e.trend||[]).filter(a=>a.keyword&&a.keyword.trim());const t={};S.value.forEach(a=>{const r=k(a.keyword),y=a.data.reduce((w,V)=>w+V.count,0);t[r]=(t[r]||0)+y}),ee.value=Object.entries(t).map(([a,r])=>({keyword:a,count:r})).filter(a=>a.count>=ce).sort((a,r)=>r.count-a.count).slice(0,10);const n=Array.from(new Set(S.value.flatMap(a=>a.data.map(r=>r.date)))).sort();n.length>0&&(K.value=n[0],N.value=n[n.length-1],h.value={start:K.value,end:N.value});const s=n.slice(-10),v={};S.value.forEach(a=>{const r=k(a.keyword);a.data.forEach(y=>{s.includes(y.date)&&(v[r]=(v[r]||0)+y.count)})}),W.value=Object.entries(v).map(([a,r])=>({keyword:a,count:r})).filter(a=>a.count>=ce).sort((a,r)=>r.count-a.count).slice(0,5),te.value=J(e.top_people||[]).slice(0,5),ne.value=J(e.top_orgs||[]).slice(0,5);const u={};S.value.forEach(a=>{const r=k(a.keyword);if(!r)return;const y=a.data.reduce((V,P)=>V+P.count,0),w=C(r);w&&(u[w]||(u[w]={name:r,count:0}),u[w].count+=y,r.length>(u[w].name||"").length&&(u[w].name=r))}),le.value=u,g.value=W.value.map(a=>a.keyword)}catch(o){console.error("âŒ åŠ è½½æ•°æ®å¤±è´¥ï¼š",o)}finally{Q.value=!1}}const I=i(5);function Z(){const o=T.value.trim();if(!o){x.value=[];return}if(!C(o)){x.value=[];return}const n=Object.values(le.value||{}).filter(s=>s.count>=I.value).filter(s=>H.value?pe(o,s.name):ve(o,s.name));n.sort((s,v)=>v.count-s.count),x.value=n.slice(0,10).map(s=>({name:s.name,count:s.count}))}function O(o){const e=B.value||document.getElementById("trendChart");if(e&&e.scrollIntoView&&e.scrollIntoView({behavior:"smooth",block:"center"}),!!m.value)try{m.value.dispatchAction({type:"highlight",name:o}),setTimeout(()=>{m.value.dispatchAction({type:"downplay",name:o}),setTimeout(()=>{m.value.dispatchAction({type:"highlight",name:o}),setTimeout(()=>{m.value.dispatchAction({type:"downplay",name:o})},600)},300)},600)}catch{}}function ae(){const o=T.value.trim();if(!o)return;const e=k(o);if(!e){T.value="",x.value=[];return}if(g.value.includes(e))setTimeout(()=>O(f(e)),100);else{g.value.push(e),_();const t=f(e);setTimeout(()=>O(t),400)}T.value="",x.value=[]}function re(o){const e=k(o);e&&(T.value="",x.value=[],g.value.includes(e)?setTimeout(()=>O(f(e)),100):(g.value.push(e),_(),setTimeout(()=>O(f(e)),400)))}function U(o){const e=k(o);if(!e)return;let t=!1;g.value.includes(e)?setTimeout(()=>O(f(e)),100):(g.value.push(e),_(),t=!0),t&&setTimeout(()=>O(f(e)),400)}function ye(o){g.value.splice(o,1),_()}function ge(){h.value={start:K.value,end:N.value},_()}function _(){if(!m.value)return;if(m.value.clear(),!g.value.length){m.value.showLoading({text:"è¯·é€‰æ‹©å…³é”®è¯",color:"#409EFF"});return}m.value.hideLoading();const e=Array.from(new Set(S.value.flatMap(n=>n.data.map(s=>s.date)))).sort().filter(n=>{const s=new Date(n),v=h.value.start?new Date(h.value.start):new Date(K.value),u=h.value.end?new Date(h.value.end):new Date(N.value);return s>=v&&s<=u}),t=[];g.value.forEach(n=>{const s=C(n),v=S.value.filter(r=>{const y=C(k(r.keyword));return s&&y&&y.includes(s)}),u=e.map(r=>{let y=0,w=[];return v.forEach(V=>{const P=V.data.find(G=>G.date===r);P&&(y+=P.count);const he=V.articles?.filter(G=>G.date===r)||[];w=w.concat(he)}),{value:y,articles:se(w)}}),a=f(n);t.push({name:a,type:"line",smooth:!0,showSymbol:!0,data:u})}),m.value.setOption({tooltip:{trigger:"item",formatter:n=>{const{data:s}=n;if(!s.articles?.length)return`${n.seriesName}<br>${n.name}ï¼š${s.value}`;const v=s.articles.slice(0,3).map(u=>`â€¢ ${f(u.title)}`).join("<br>");return`<b>${n.seriesName}</b><br>${n.name}ï¼š${s.value} æ¬¡<br><hr>${v}`}},legend:{data:t.map(n=>n.name)},xAxis:{type:"category",data:e},yAxis:{type:"value",name:"å‡ºç°æ¬¡æ•°"},series:t}),m.value.off("click"),m.value.on("click",n=>{const{event:s,data:v}=n;if(!v.articles?.length)return;oe.value=se(v.articles);const u=B.value?.getBoundingClientRect(),a=320,r=s.event.clientX,y=u?u.right-r:window.innerWidth-r;Y.value={x:y>a+20?s.offsetX+20:s.offsetX-a-20,y:s.offsetY+20},R.value=!0}),m.value.getZr().on("click",n=>{n.target||(R.value=!1)})}return ke(async()=>{await de(),m.value=_e(B.value),m.value.showLoading({text:"åŠ è½½ä¸­...",color:"#409EFF"}),await me(),_()}),(o,e)=>(d(),c("div",Me,[l("div",Se,[l("h3",null,[e[15]||(e[15]=b(" ğŸ”¥ çƒ­ç‚¹å…³é”®è¯æ’è¡Œæ¦œï¼ˆæ€»æ¦œå‰10ï¼‰ ",-1)),l("span",{class:"tooltip",onMouseenter:e[0]||(e[0]=t=>A(t,"åŸºäºå…¨éƒ¨æ–°é—»ç»Ÿè®¡çš„å‡ºç°æ¬¡æ•°æ’åï¼Œç‚¹å‡»å…³é”®è¯å¯æŸ¥çœ‹è¶‹åŠ¿ã€‚")),onMouseleave:E},"â”",32)]),l("ol",null,[(d(!0),c($,null,D(ee.value,(t,n)=>(d(),c("li",{key:n,onClick:s=>U(t.keyword)},[l("span",null,p(n+1)+". "+p(f(t.keyword)),1),l("span",$e,p(t.count)+" æ¬¡",1)],8,Te))),128))]),l("h3",De,[e[16]||(e[16]=b(" ğŸ“… è¿‘ 10 æ—¥çƒ­é—¨å…³é”®è¯ï¼ˆå‰5ï¼‰ ",-1)),l("span",{class:"tooltip",onMouseenter:e[1]||(e[1]=t=>A(t,"åŸºäºæœ€è¿‘10å¤©æ–°é—»å‡ºç°é¢‘æ¬¡è®¡ç®—ï¼Œåæ˜ è¿‘æœŸçƒ­åº¦å˜åŒ–ã€‚")),onMouseleave:E},"â”",32)]),l("ol",null,[(d(!0),c($,null,D(W.value,(t,n)=>(d(),c("li",{key:n,onClick:s=>U(t.keyword)},[l("span",null,p(n+1)+". "+p(f(t.keyword)),1),l("span",Ee,p(t.count)+" æ¬¡",1)],8,Ae))),128))])]),l("div",Ie,[l("h2",null,[e[17]||(e[17]=b(" AI æ–°é—»è¶‹åŠ¿åˆ†æ ",-1)),l("button",{class:"help-btn",onClick:e[2]||(e[2]=t=>q.value=!0)},"ğŸ›ˆ ä½¿ç”¨è¯´æ˜")]),l("div",Oe,[e[21]||(e[21]=l("label",null,"æœç´¢å…³é”®è¯ï¼š",-1)),F(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>T.value=t),onInput:Z,onKeyup:ue(ae,["enter"]),placeholder:"è¯·è¾“å…¥å…³é”®è¯..."},null,544),[[L,T.value]]),l("button",{onClick:ae},"æ·»åŠ "),l("label",Ve,[F(l("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>H.value=t)},null,512),[[be,H.value]]),e[18]||(e[18]=l("span",{class:"toggle-slider"},null,-1)),e[19]||(e[19]=l("span",{class:"toggle-text"},"å®½æ¾åŒ¹é…å»ºè®®",-1)),l("span",{class:"tooltip",onMouseenter:e[5]||(e[5]=t=>A(t,"å¼€å¯åå¯æ¨¡ç³ŠåŒ¹é…ç›¸ä¼¼å…³é”®è¯")),onMouseleave:E},"â”",32)]),l("label",je,[e[20]||(e[20]=b(" å‡ºç°æ¬¡æ•°é˜ˆå€¼ï¼š ",-1)),F(l("input",{type:"range",min:"1",max:"20","onUpdate:modelValue":e[6]||(e[6]=t=>I.value=t),onInput:Z},null,544),[[L,I.value]]),F(l("input",{type:"number",min:"1",max:"20","onUpdate:modelValue":e[7]||(e[7]=t=>I.value=t),onInput:Z,style:{width:"50px","margin-left":"4px"}},null,544),[[L,I.value,void 0,{number:!0}]]),l("span",{class:"tooltip",onMouseenter:e[8]||(e[8]=t=>A(t,"æ§åˆ¶å»ºè®®è¯ä¸­å‡ºç°é¢‘æ¬¡çš„æœ€ä½é˜ˆå€¼ã€‚æ•°å€¼è¶Šé«˜ï¼Œç»“æœè¶Šç²¾ç¡®ä½†æ›´å°‘ã€‚")),onMouseleave:E},"â”",32)]),l("div",Fe,"å½“å‰é˜ˆå€¼ï¼šâ‰¥"+p(I.value)+" æ¬¡",1)]),l("div",Ke,[e[22]||(e[22]=l("label",null,"æ—¥æœŸèŒƒå›´ï¼š",-1)),F(l("input",{type:"date","onUpdate:modelValue":e[9]||(e[9]=t=>h.value.start=t),min:K.value,max:h.value.end,onChange:_},null,40,Ne),[[L,h.value.start]]),e[23]||(e[23]=l("span",null,"è‡³",-1)),F(l("input",{type:"date","onUpdate:modelValue":e[10]||(e[10]=t=>h.value.end=t),min:h.value.start,max:N.value,onChange:_},null,40,Le),[[L,h.value.end]]),l("button",{onClick:ge,class:"reset-date-btn"},"é‡ç½®")]),x.value.length?(d(),c("ul",ze,[(d(!0),c($,null,D(x.value,(t,n)=>(d(),c("li",{key:n,class:"suggestion-item",onClick:s=>re(t.name),onKeydown:ue(xe(s=>re(t.name),["prevent"]),["enter"]),tabindex:"0"},[l("span",Re,p(f(t.name)),1),l("span",Ue,p(t.count)+" æ¬¡",1)],40,Be))),128))])):j("",!0),g.value.length?(d(),c("div",Pe,[e[24]||(e[24]=l("strong",null,"å·²é€‰å…³é”®è¯ï¼š",-1)),(d(!0),c($,null,D(g.value,(t,n)=>(d(),c("span",{key:t,class:"tag"},[b(p(f(t))+" ",1),l("button",{onClick:s=>ye(n)},"Ã—",8,Xe)]))),128))])):j("",!0),l("div",{id:"trendChart",ref_key:"chartRef",ref:B,class:"chart"},null,512),Q.value?(d(),c("p",qe,"æ•°æ®åŠ è½½ä¸­...")):j("",!0),R.value?(d(),c("div",{key:3,class:"news-popup",style:ie({left:Y.value.x+"px",top:Y.value.y+"px"})},[l("div",We,[e[25]||(e[25]=l("strong",null,"ç›¸å…³æ–°é—»",-1)),l("button",{class:"close-btn",onClick:e[11]||(e[11]=t=>R.value=!1)},"Ã—")]),l("ul",null,[(d(!0),c($,null,D(oe.value,(t,n)=>(d(),c("li",{key:n},[t.url&&t.title?(d(),c("a",{key:0,href:t.url,target:"_blank"},p(f(t.title)),9,Ye)):(d(),c("div",He,p(f(t.title||"ï¼ˆæ— æ ‡é¢˜ï¼‰")),1))]))),128))])],4)):j("",!0)]),l("div",Ze,[l("div",Ge,[l("h3",null,[e[26]||(e[26]=b(" ğŸ‘¤ äººç‰©æ’è¡Œæ¦œ ",-1)),l("span",{class:"tooltip",onMouseenter:e[12]||(e[12]=t=>A(t,"äººç‰©å‡ºç°æ¬¡æ•°ç»Ÿè®¡ï¼Œç‚¹å‡»æŸ¥çœ‹è¶‹åŠ¿ã€‚")),onMouseleave:E},"â”",32)]),l("ol",null,[(d(!0),c($,null,D(te.value,(t,n)=>(d(),c("li",{key:n,onClick:s=>U(t.name)},[b(p(n+1)+". "+p(f(t.name))+" ",1),l("span",Qe,p(t.value)+" æ¬¡",1)],8,Je))),128))])]),l("div",et,[l("h3",null,[e[27]||(e[27]=b(" ğŸ¢ æœºæ„æ’è¡Œæ¦œ ",-1)),l("span",{class:"tooltip",onMouseenter:e[13]||(e[13]=t=>A(t,"æœºæ„å‡ºç°æ¬¡æ•°ç»Ÿè®¡ï¼Œç‚¹å‡»æŸ¥çœ‹è¶‹åŠ¿ã€‚")),onMouseleave:E},"â”",32)]),l("ol",null,[(d(!0),c($,null,D(ne.value,(t,n)=>(d(),c("li",{key:n,onClick:s=>U(t.name)},[b(p(n+1)+". "+p(f(t.name))+" ",1),l("span",nt,p(t.value)+" æ¬¡",1)],8,tt))),128))])])]),q.value?(d(),c("div",ot,[l("div",lt,[e[28]||(e[28]=l("strong",null,"ä½¿ç”¨è¯´æ˜",-1)),l("button",{class:"close-btn",onClick:e[14]||(e[14]=t=>q.value=!1)},"Ã—")]),e[29]||(e[29]=Ce('<div class="popup-content" data-v-12633536><ul data-v-12633536><li data-v-12633536><b data-v-12633536>æœç´¢å…³é”®è¯ï¼š</b> è¾“å…¥å…³é”®è¯ä»¥æŸ¥çœ‹å…¶åœ¨æ–°é—»ä¸­çš„è¶‹åŠ¿å˜åŒ–ã€‚</li><li data-v-12633536><b data-v-12633536>å®½æ¾åŒ¹é…å»ºè®®ï¼š</b> å¼€å¯åå¯æ¨¡ç³ŠåŒ¹é…ç›¸ä¼¼è¯ã€‚</li><li data-v-12633536><b data-v-12633536>å‡ºç°æ¬¡æ•°é˜ˆå€¼ï¼š</b> æ§åˆ¶è”æƒ³å»ºè®®çš„æœ€å°å‡ºç°é¢‘æ¬¡ã€‚</li><li data-v-12633536><b data-v-12633536>æ—¥æœŸèŒƒå›´ç­›é€‰ï¼š</b> å¯é€‰æ‹©ç‰¹å®šæ—¶é—´æ®µæŸ¥çœ‹è¶‹åŠ¿ã€‚</li><li data-v-12633536><b data-v-12633536>ç‚¹å‡»å…³é”®è¯ï¼š</b> æ·»åŠ åˆ°è¶‹åŠ¿å›¾ä¸­å¯¹æ¯”ã€‚</li><li data-v-12633536><b data-v-12633536>ç‚¹å‡»æŠ˜çº¿èŠ‚ç‚¹ï¼š</b> æŸ¥çœ‹ç›¸å…³æ–°é—»ã€‚</li></ul></div>',1))])):j("",!0),z.value?(d(),c("div",{key:1,class:"hover-tip",style:ie({left:X.value.x+"px",top:X.value.y+"px"})},p(z.value),5)):j("",!0)]))}},it=we(st,[["__scopeId","data-v-12633536"]]);export{it as default};
