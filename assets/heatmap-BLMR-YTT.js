import{_ as Qe,r as _,a as Xe,c as E,q as le,o as Ze,d as m,f as a,g as F,F as ce,j as de,w as Z,v as Je,l as et,s as Me,e as $e,t as w,i as ue,m as xe,n as P,h as p,x as tt,p as Ie}from"./index-pUqQA_y_.js";import{i as he}from"./index-ClPwX7rX.js";const ot={class:"graph-container"},st={class:"sidebar left"},nt=["onClick","title"],rt={class:"node-label"},it={key:0,class:"dot"},at={class:"hover-actions"},lt=["onClick"],ct=["onClick"],dt={class:"main-content"},ut={key:0,class:"cluster-list-container"},ht={class:"cluster-list-header"},ft={class:"filter-controls"},gt={class:"search-controls"},mt={class:"search-box"},pt={class:"toggle-controls"},vt={class:"toggle"},wt={class:"filter-sort-controls"},yt={class:"cluster-list"},Ct=["onClick","onMouseover"],_t={class:"cluster-header"},bt={class:"cluster-title"},St={class:"cluster-count"},Nt={class:"cluster-summary"},kt={class:"cluster-meta"},Mt={class:"cluster-links"},$t={class:"cluster-weight"},xt={key:0,class:"no-results"},It={key:1,class:"chart-container"},Tt={class:"chart-header"},Lt={class:"sidebar right"},Dt={class:"node-detail"},zt={key:0},Wt=["href"],Et={key:1},Ft={class:"node-time"},Rt={key:0,class:"summary-text"},Ot={key:1,class:"cluster-stats"},Bt={key:1},At={class:"related-section"},Vt=["onClick"],jt={class:"related-header"},Ht=["href"],Ut={key:1,class:"related-title"},Gt={class:"weight-info"},Yt={class:"weight-bar"},Pt={class:"weight-text"},qt={class:"mini-chart-container"},Te=8,Kt={__name:"heatmap",setup(Qt){let J=[];const ee=_(null),fe=_(null);let c=null,b=null,y=[],M=[];const q=_(""),te=_(!1),K=_(""),oe=_({x:0,y:0}),ge=_([]),R=_("all"),O=_("default"),n=Xe({currentId:null,pathNodes:[],pathLinks:new Set,derived:{},fadedNodes:new Set,isInClusterMode:!1,currentClusterId:null,nodeStates:new Map}),S=_(null),se=E(()=>n.pathNodes),me=E(()=>n.currentId);function Le(t,e){K.value=e;const o=t.target.getBoundingClientRect();oe.value={x:o.right+10,y:o.top-10+window.scrollY}}function De(){K.value=""}function ze(t){return!t||!t.trim()?"":t.trim()}function Q(t){return t?ze(String(t)).toLowerCase().trim().replace(/[\s\-_]+/g,"").replace(/[^\w\u4e00-\u9fa5]/g,""):""}function pe(t,e){if(!t||!e)return!1;const o=Q(t),s=Q(e);return!o||!s?!1:s.includes(o)}function ve(t,e){if(!t||!e)return!1;const o=Q(t),s=Q(e);if(!o||!s)return!1;const r=We(o,s),i=Ee(o.length);return r>=i}function We(t,e){let o=0,s=0;for(let r=0;r<t.length;r++){const i=t[r];for(let l=s;l<e.length;l++)if(e[l]===i){o++,s=l+1;break}}return o/t.length}function Ee(t){return t<2?1:t<=4?.6:.5}function we(){}function B(t){if(!t)return"æœªçŸ¥æ—¥æœŸ";try{const e=new Date(t);if(isNaN(e.getTime())){const i=t.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/);if(i){const[l,d,u,f]=i;return`${d}-${u.padStart(2,"0")}-${f.padStart(2,"0")}`}return t}const o=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${o}-${s}-${r}`}catch{return t}}function T(t){if(!t)return"æœªçŸ¥æ—¶é—´";try{let e;if(t.includes("T")){if(e=new Date(t),isNaN(e.getTime())){const u=t.replace("Z","").split("T");return u.length===2?`${u[0]} ${u[1].substring(0,8)}`:t}const o=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0"),d=String(e.getSeconds()).padStart(2,"0");return`${o}-${s}-${r} ${i}:${l}:${d}`}else return B(t)}catch(e){return console.warn("æ—¶é—´æ ¼å¼åŒ–é”™è¯¯:",t,e),t}}function Fe(t){const e=new Map;y.forEach(s=>{if(s.time){const r=new Date(s.time);e.set(s.id,isNaN(r.getTime())?null:r)}});const o=t.map(s=>{const r=e.get(s.source),i=e.get(s.target);let l=s.source,d=s.target,u="unknown",f="æ—¶é—´æœªçŸ¥",A=null,V=null;return r&&i&&!isNaN(r.getTime())&&!isNaN(i.getTime())?r<i?(l=s.source,d=s.target,u="forward",A=s.source,V=s.target,f=`${B(s.source)} â†’ ${B(s.target)}`):r>i?(l=s.target,d=s.source,u="reverse",A=s.target,V=s.source,f=`${B(s.target)} â†’ ${B(s.source)}`):(l=s.source,d=s.target,u="same",f="åŒæ—¶å‘ç”Ÿ"):(u="unknown",f="æ—¶é—´ä¿¡æ¯ä¸è¶³"),{...s,source:l,target:d,time_direction:u,direction_label:f,original_source:s.source,original_target:s.target,early_node:A,late_node:V}});return console.log("åŸºäºæ—¶é—´è®¡ç®—çš„é“¾æ¥æ–¹å‘(æ—©â†’æ™š):",o),o}function Re(t,e){return Math.round(Math.abs((t-e)/864e5))<=7&&t<=e}function Oe(t,e,o){return Math.round(Math.abs((t-e)/864e5))<=o&&t<=e}function Be(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()}function Ae(t,e,o){const s=new Date(e);return s.setMonth(s.getMonth()-o),t>=s&&t<=e}function ye(t){const e=t.match(/(\d{4}-\d{2}-\d{2})/g);if(!e||e.length===0)return null;const o=new Date(e[e.length-1]);return isNaN(o.getTime())?null:o}function Ce(t,e,o="desc"){const s=ye(t.summary),r=ye(e.summary);return!s&&!r?0:s?r?o==="desc"?r.getTime()-s.getTime():s.getTime()-r.getTime():o==="desc"?-1:1:o==="desc"?1:-1}const Ve=E(()=>n.isInClusterMode&&n.currentClusterId?window.__clusterCache?.get(n.currentClusterId)?.summary||"ä¸»é¢˜ç°‡è¯¦æƒ…":"æ–°é—»å…³è”å›¾è°±"),_e=E(()=>{let t=ge.value;const e=q.value.trim();if(e&&(e.toLowerCase(),t=t.filter(o=>{const s=o.name.toLowerCase(),r=o.summary.toLowerCase();return te.value?ve(e,s)||ve(e,r):pe(e,s)||pe(e,r)})),R.value!=="all"){const o=new Date;t=t.filter(s=>{const r=s.summary.match(/(\d{4}-\d{2}-\d{2})/g);if(!r||r.length===0)return!0;const i=new Date(r[r.length-1]);if(isNaN(i.getTime()))return!0;switch(R.value){case"week":return Re(i,o);case"10days":return Oe(i,o,10);case"month":return Be(i,o);case"3months":return Ae(i,o,3);default:return!0}})}return O.value!=="default"&&(t=[...t].sort((o,s)=>{switch(O.value){case"timeDesc":return Ce(o,s,"desc");case"timeAsc":return Ce(o,s,"asc");case"nodesDesc":return s.nodeCount-o.nodeCount;case"nodesAsc":return o.nodeCount-s.nodeCount;default:return 0}})),t});function be(t){if(t.startsWith("super")){const o=window.__clusterCache?.get(t);return o?o.summary||"ä¸»é¢˜ç°‡":J.find(r=>r.id===t)?.name||"ä¸»é¢˜ç°‡"}const e=y.find(o=>o.id===t);return e&&e.title||t}function z(t){if(!t)return"";if(t.length<=8||t.length<=15)return t;const e=t.substring(0,8),o=t.substring(8,15);return e+`
`+o+"..."}const N=E(()=>{const t=S.value||n.currentId;if(console.log("Display node ID:",t,"Hover:",S.value,"Current:",n.currentId),!t)return null;if(t.startsWith("super")){const o=window.__clusterCache?.get(t);if(o){J.find(l=>l.id===t);const s=o.nodes.map(l=>l.time).filter(l=>l).sort();let r="æ—¶é—´æœªçŸ¥";if(s.length>0){const l=s[0],d=s[s.length-1];l===d?r=`å‘å¸ƒæ—¶é—´: ${T(l)}`:r=`æ—¶é—´èŒƒå›´: ${T(l)} - ${T(d)}`}const i={id:t,title:o.summary||"ä¸»é¢˜ç°‡",summary:`åŒ…å« ${o.nodes.length} ä¸ªç›¸å…³èŠ‚ç‚¹ï¼Œ${o.links.length} æ¡å…³è”`,time:r,url:null,isSuper:!0};return console.log("Super node display:",i),i}}const e=y.find(o=>o.id===t);return e?{...e,time:T(e.time)}:(console.log("Found node:",e),e)}),je=E(()=>{const t=S.value||n.currentId;if(console.log("Getting related nodes for:",t,"Cluster mode:",n.isInClusterMode,"Current cluster:",n.currentClusterId),n.isInClusterMode&&n.currentClusterId&&(!t||t===n.currentClusterId)){const r=window.__clusterCache.get(n.currentClusterId);if(r)return console.log("Showing all cluster nodes on cluster entry:",r.nodes.length,"nodes"),r.nodes.map(i=>({...i,weight:1}))}if(!t)return[];if(t.startsWith("super")){const r=window.__clusterCache?.get(t);if(r)return console.log("Found cluster cache for super node:",r.nodes.length,"nodes"),r.nodes.map(i=>({...i,weight:1}))}let e=[];if(n.isInClusterMode){const r=window.__clusterCache.get(n.currentClusterId);if(r){const i=new Set(r.nodes.map(l=>l.id));r.links.forEach(l=>{if(l.source===t&&i.has(l.target)){const d=r.nodes.find(u=>u.id===l.target);d&&e.push({...d,weight:l.weight||0})}})}}else M.forEach(r=>{if(r.source===t){const i=y.find(l=>l.id===r.target);i&&e.push({...i,weight:r.weight||0})}});console.log("Found neighbors:",e.length);const o=[],s=new Set;return e.forEach(r=>{s.has(r.id)||(s.add(r.id),o.push(r))}),n.isInClusterMode?o.sort((r,i)=>i.weight-r.weight):o.sort((r,i)=>i.weight-r.weight).slice(0,Te)});function Se(t,e=Te,o=.2){const s=M.filter(r=>r.source===t).map(r=>({...r,other:r.target,weight:r.weight||0})).filter(r=>r.weight>=o).sort((r,i)=>i.weight-r.weight).slice(0,e);return console.log(`Top ${e} neighbors for ${t}:`,s),s.map(r=>r.other)}_(new Map),_(!1);function ne(t,e){if(!t)return;n.nodeStates.set(e,{isInClusterMode:!0,currentClusterId:e,timestamp:Date.now()});const{nodes:o,links:s}=t,r=new Set(y.map(d=>d.id)),i=o.filter(d=>r.has(d.id)),l=s.filter(d=>r.has(d.source)&&r.has(d.target));if(n.isInClusterMode=!0,n.currentClusterId=e,!n.pathNodes.includes(e)){const d=n.pathNodes[n.pathNodes.length-1];d&&n.pathLinks.add(`${d}-${e}`),n.pathNodes.push(e)}n.currentId=e,P(()=>{c||(c=he(ee.value)),c.clear(),c.setOption({tooltip:{show:!0,trigger:"item",formatter:u=>{if(u.dataType==="node"){const f=u.data;return`
              <div style="padding: 8px; max-width: 300px; word-wrap: break-word; overflow-wrap: break-word;">
                <div style="font-weight: bold; margin-bottom: 4px; color: #2c3e50; white-space: normal;">${f.title||f.name||f.id}</div>
                ${f.summary?`<div style="color: #666; font-size: 12px; line-height: 1.4; white-space: normal; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">${f.summary}</div>`:""}
                ${f.time?`<div style="color: #999; font-size: 11px; margin-top: 4px;">ğŸ•’ ${f.time}</div>`:""}
              </div>
            `}return""},backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#ddd",borderWidth:1,textStyle:{color:"#333"},confine:!0,extraCssText:"max-width: 320px; word-break: break-word;"},animationDurationUpdate:500,series:[{type:"graph",layout:"force",force:{repulsion:260,gravity:.05,edgeLength:[80,180]},data:i.map(u=>({...u,name:z(u.name||u.title||u.id),symbolSize:50,itemStyle:{color:u.id===e?"#27ae60":"#3498db"},label:{show:!0,position:"inside",fontSize:10,color:"#111",fontWeight:"bold",backgroundColor:"transparent",borderColor:"transparent",borderWidth:0,borderRadius:0,padding:0,lineHeight:15,formatter:function(f){return z(f.data.title||f.data.name||f.data.id)}},emphasis:{scale:!0,itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}})),links:l.map(u=>({...u,symbol:["none","arrow"],symbolSize:[0,8],lineStyle:{width:2,color:"#888",opacity:.9}})),roam:!0,draggable:!0,emphasis:{focus:"none",scale:!0}}]},{replaceMerge:["series"]}),c.resize();function d(){c.off("finished",d),re(e)}c.on("finished",d),c.off("click"),c.on("click",u=>{u.dataType==="node"&&(console.log("Cluster chart click:",u.data.id),x(u.data.id))}),c.off("mouseover"),c.on("mouseover",u=>{u.dataType==="node"&&(console.log("Cluster mouse over:",u.data.id),S.value=u.data.id,n.currentId=u.data.id)}),c.off("mouseout"),c.on("mouseout",()=>{console.log("Cluster mouse out"),S.value=null,n.currentId=n.pathNodes[n.pathNodes.length-1]||null})}),$()}function He(t){if(!t)return;console.log("Deriving neighbors for:",t),n.derived[t]||(n.derived[t]=[]);const e=new Set([...n.pathNodes]);for(const r in n.derived)(n.derived[r]||[]).forEach(i=>e.add(i));const s=Se(t).filter(r=>!e.has(r)).filter(r=>M.some(i=>i.source===t&&i.target===r));console.log("Valid candidates:",s),s.length&&n.derived[t].push(...s),X(t)}function Ue(t=n.currentId){const e=new Set([...n.pathNodes]);for(const s of n.pathNodes)(n.derived[s]||[]).forEach(r=>e.add(r));const o=new Set;t&&(o.add(t),(n.derived[t]||[]).forEach(s=>o.add(s))),n.fadedNodes=new Set,e.forEach(s=>{o.has(s)||n.fadedNodes.add(s)})}function Ge(t){return t===n.currentId?"#e74c3c":n.pathNodes.includes(t)?"#27ae60":(n.currentId,"#bfdbfe")}function Ye(){const t=[];for(const e of n.pathNodes)(n.derived[e]||[]).forEach(o=>t.push({source:e,target:o}));return t.map(e=>({...e,symbol:["none","arrow"],symbolSize:[0,8],lineStyle:{width:n.pathLinks.has(`${e.source}-${e.target}`)?3:2,color:n.pathLinks.has(`${e.source}-${e.target}`)?"#e74c3c":"#888",opacity:.9,transition:"opacity 0.3s"}}))}function re(t){if(!c||!t)return;const e=c.getModel().getSeriesByIndex(0);if(!e)return;const o=e.getData();if(!o||typeof o.indexOfRawData!="function")return;const s=o.indexOfRawData(t);if(s==null||s<0)return;const r=o.getItemLayout(s);if(!r)return;const i=c.getWidth()/2-r[0],l=c.getHeight()/2-r[1];c.dispatchAction({type:"graphRoam",dx:i,dy:l})}function X(t){c||(c=he(ee.value)),Ue(t);let e=Ye();t||(e=M.sort((o,s)=>(s.weight||0)-(o.weight||0)).slice(0,50).map(o=>({...o,symbol:["none","arrow"],symbolSize:[0,8],lineStyle:{width:2,color:"#888",opacity:.8}}))),t&&(n.currentId=t),c.clear(),c.setOption({tooltip:{show:!0,trigger:"item",formatter:o=>{if(o.dataType==="node"){const s=o.data;return`
            <div style="padding: 8px; max-width: 300px; word-wrap: break-word; overflow-wrap: break-word;">
              <div style="font-weight: bold; margin-bottom: 4px; color: #2c3e50; white-space: normal;">${s.title||s.name||s.id}</div>
              ${s.summary?`<div style="color: #666; font-size: 12px; line-height: 1.4; white-space: normal; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">${s.summary}</div>`:""}
              ${s.time?`<div style="color: #999; font-size: 11px; margin-top: 4px;">ğŸ•’ ${s.time}</div>`:""}
            </div>
          `}return""},backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#ddd",borderWidth:1,textStyle:{color:"#333"},confine:!0,extraCssText:"max-width: 320px; word-break: break-word;"},animationDurationUpdate:500,series:[{type:"graph",layout:"force",data:y.map(o=>({...o,name:z(o.title||o.name||o.id),symbolSize:o.symbolSize||40,itemStyle:{color:Ge(o.id),opacity:1},label:{show:!0,position:"inside",fontSize:10,color:"#888",fontWeight:"bold",backgroundColor:"transparent",borderColor:"transparent",borderWidth:0,borderRadius:0,padding:0,lineHeight:15,formatter:function(s){return z(s.data.title||s.data.name||s.data.id)}},emphasis:{scale:!0,itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}})),links:e,roam:!0,draggable:!0,emphasis:{focus:"none",scale:!0},force:{repulsion:500,gravity:.08,edgeLength:[100,200]},focusNodeAdjacency:!1}]}),c.resize(),c.off("mouseover"),c.on("mouseover",o=>{o.dataType==="node"&&(console.log("Mouse over node:",o.data.id),S.value=o.data.id)}),c.off("mouseout"),c.on("mouseout",()=>{console.log("Mouse out"),S.value=null}),c.off("click"),c.on("click",o=>{o.dataType==="node"&&(console.log("Click node:",o.data.id),x(o.data.id))})}function $(){b||(b=he(fe.value));const t=S.value||n.currentId;let e=[],o=[];if(!t){b.clear(),b.setOption({title:{text:"è¯·é€‰æ‹©èŠ‚ç‚¹æŸ¥çœ‹å…³è”",left:"center",top:"center",textStyle:{color:"#999",fontSize:14}},series:[]});return}if(n.isInClusterMode&&t&&!t.startsWith("super")){const s=window.__clusterCache.get(n.currentClusterId);if(s){const r=new Set(s.nodes.map(l=>l.id)),i=s.nodes.find(l=>l.id===t);if(i){e=[i];const l=new Set;s.links.forEach(d=>{d.source===t&&r.has(d.target)&&(l.add(d.target),o.push({source:d.source,target:d.target,symbol:["none","arrow"],symbolSize:[0,6],lineStyle:{width:1.5,color:"#888",opacity:.9}}))}),l.forEach(d=>{const u=s.nodes.find(f=>f.id===d);u&&e.push(u)})}}}else if(t&&t.startsWith("super")){const s=window.__clusterCache?.get(t);s&&(e=s.nodes,o=s.links.map(r=>({...r,symbol:["none","arrow"],symbolSize:[0,6],lineStyle:{width:1.5,color:"#888",opacity:.9}})))}else{const s=y.find(r=>r.id===t);if(s){e=[s];const r=new Set;M.forEach(i=>{i.source===t&&(r.add(i.target),o.push({source:i.source,target:i.target,symbol:["none","arrow"],symbolSize:[0,6],lineStyle:{width:1.5,color:"#888",opacity:.9}}))}),r.forEach(i=>{const l=y.find(d=>d.id===i);l&&e.push(l)})}}if(e.length<=1){b.clear(),b.setOption({title:{text:"è¯¥èŠ‚ç‚¹æ²¡æœ‰ç›´æ¥å…³è”èŠ‚ç‚¹",left:"center",top:"center",textStyle:{color:"#999",fontSize:14}},series:[]});return}b.clear(),b.setOption({tooltip:{show:!0,formatter:s=>s.dataType==="node"?s.data.title||s.data.name||s.data.id:""},series:[{type:"graph",layout:"force",data:e.map(s=>({...s,name:z(s.title||s.name||s.id),symbolSize:t&&s.id===t?45:32,itemStyle:{color:t&&s.id===t?"#e74c3c":"#3498db"},label:{show:!0,position:"inside",fontSize:9,color:"#111",fontWeight:"bold",backgroundColor:"transparent",borderColor:"transparent",borderWidth:0,borderRadius:0,padding:0,formatter:r=>z(r.data.title||r.data.name||r.data.id)}})),links:o,roam:!0,draggable:!0,force:{repulsion:150,edgeLength:[80,120],gravity:.1}}]}),b.resize(),b.off("click"),b.on("click",s=>{s.dataType==="node"&&x(s.data.id)})}function x(t){if(!t)return;if(console.log("Focusing on node:",t,"Cluster mode:",n.isInClusterMode),n.nodeStates.set(t,{isInClusterMode:n.isInClusterMode,currentClusterId:n.currentClusterId,timestamp:Date.now()}),n.isInClusterMode){const o=n.pathNodes[n.pathNodes.length-1];o&&o!==t&&n.pathLinks.add(`${o}-${t}`),n.pathNodes.includes(t)||n.pathNodes.push(t),n.currentId=t,Ne(t),$();return}const e=n.pathNodes[n.pathNodes.length-1];e&&e!==t&&n.pathLinks.add(`${e}-${t}`),n.pathNodes.includes(t)||n.pathNodes.push(t),n.currentId=t,He(t),X(t),re(t),$()}function Ne(t){if(!c||!n.isInClusterMode||!window.__clusterCache.get(n.currentClusterId))return;const o=c.getOption(),s=o.series[0];s.data=s.data.map(r=>{const i={...r.itemStyle};return r.id===t?i.color="#e74c3c":n.pathNodes.includes(r.id)?i.color="#27ae60":i.color="#3498db",{...r,itemStyle:i}}),c.setOption(o)}function Pe(t){if(t<0||t>=n.pathNodes.length)return;const e=n.pathNodes[t];console.log("Backtracking to:",e,"at index:",t),n.pathNodes=n.pathNodes.slice(0,t+1),n.currentId=e;const o=new Set;for(let i=0;i<n.pathNodes.length-1;i++)o.add(`${n.pathNodes[i]}-${n.pathNodes[i+1]}`);n.pathLinks=o;const s=n.nodeStates.get(e);s?(console.log("Restoring saved state for node:",e,s),n.isInClusterMode=s.isInClusterMode,n.currentClusterId=s.currentClusterId):(console.log("No saved state found for node:",e,"using default"),n.isInClusterMode=!1,n.currentClusterId=null);const r=new Set(n.pathNodes);for(const i in n.derived)r.has(i)?n.derived[i]=n.derived[i].filter(l=>r.has(l)||Se(i).includes(l)):delete n.derived[i];P(()=>{if(n.isInClusterMode&&n.currentClusterId){const i=window.__clusterCache?.get(n.currentClusterId);i&&(c&&(c.dispose(),c=null),P(()=>{ne(i,n.currentClusterId),setTimeout(()=>{e!==n.currentClusterId&&(n.currentId=e,Ne(e))},100)}))}else c&&(c.dispose(),c=null),P(()=>{X(e),re(e),$(),ie(),setTimeout(()=>{n.currentId=e,X(e)},50)})})}function qe(){n.currentId=null,n.pathNodes=[],n.pathLinks=new Set,n.derived={},n.fadedNodes=new Set,n.isInClusterMode=!1,n.currentClusterId=null,n.nodeStates.clear(),q.value="",R.value="all",O.value="default",P(()=>{c&&(c.dispose(),c=null),$(),ie()})}function ie(){c&&(c.off("click"),c.on("click",t=>{if(console.log("Chart click:",t,"Cluster mode:",n.isInClusterMode),t.dataType==="node"){const e=t.data.id;if(n.isInClusterMode)x(e);else if(e.startsWith("super")){const o=window.__clusterCache.get(e);o&&ne(o,e)}else x(e)}}))}return le(S,()=>{$()}),le(me,()=>{$()}),le(()=>n.isInClusterMode,()=>{$()}),Ze(async()=>{const e=await(await fetch("/news_graph_causal.json")).json();window.__clusterSummaries=e.cluster_summaries||{},y=e.force_graph.nodes.sort((h,g)=>(g.time||"").localeCompare(h.time||""));const o=new Set(y.map(h=>h.id)),s=e.force_graph.links.filter(h=>o.has(h.source)&&o.has(h.target));M=Fe(s);const r=y.find(h=>h.type==="summary"||h.id==="summary_global");!!r&&(r.symbolSize=60,r.itemStyle={color:"#FFD700",borderColor:"#fff",borderWidth:2});const l=[],d=[],u=new Map;Object.entries(window.__clusterSummaries).forEach(([h,g],j)=>{if(!g.node_ids||g.node_ids.length<2)return;const H=`super_${j}`,C=g.node_ids,W=y.filter(v=>C.includes(v.id)),U=M.filter(v=>C.includes(v.source)&&C.includes(v.target));l.push({id:H,name:g.summary||`AIæ–°é—»é›†ç¾¤ ${j}`,isSuper:!0,innerIds:C,symbolSize:50+Math.min(C.length*2,30),category:j,summary:g.summary||`åŒ…å« ${C.length} ä¸ªç›¸å…³æ–°é—»èŠ‚ç‚¹`});const k=M.filter(v=>C.includes(v.source)&&!C.includes(v.target)||!C.includes(v.source)&&C.includes(v.target)),I=new Map;k.forEach(v=>{let G;C.includes(v.source)?G=v.target:G=v.source;let Y=null;if(Object.entries(window.__clusterSummaries).forEach(([L,D])=>{L!==h&&D.node_ids.includes(G)&&(Y=`super_${Object.keys(window.__clusterSummaries).indexOf(L)}`)}),Y){const L=`${H}-${Y}`,D=I.get(L)||{totalWeight:0,count:0};I.set(L,{totalWeight:D.totalWeight+(v.weight||1),count:D.count+1})}}),I.forEach((v,G)=>{const[Y,L]=G.split("-"),D=v.totalWeight/v.count;D>.1&&d.push({source:Y,target:L,weight:Math.round(D*100)/100})}),u.set(H,{nodes:W,links:U,summary:g.summary})});const f=new Set;M.forEach(h=>{f.add(h.source),f.add(h.target)});const V=y.filter(h=>f.has(h.id)).slice(0,100),Ke=new Set(V.map(h=>h.id)),ke=new Set;Object.values(window.__clusterSummaries).forEach(h=>{h.node_ids&&h.node_ids.forEach(g=>ke.add(g))});const ae=y.filter(h=>Ke.has(h.id)&&!ke.has(h.id));J=[...ae,...l],[...M.filter(h=>ae.some(g=>g.id===h.source)&&ae.some(g=>g.id===h.target)),...d],window.__clusterCache=u,ge.value=Array.from(u.entries()).map(([h,g])=>{const j=g.nodes.length,H=g.links.length,C=g.links.length>0?(g.links.reduce((k,I)=>k+(I.weight||0),0)/g.links.length).toFixed(2):"0.00",W=g.nodes.map(k=>k.time).filter(k=>k).sort();let U="æ—¶é—´æœªçŸ¥";if(W.length>0){const k=W[0],I=W[W.length-1];k===I?U=`å‘å¸ƒæ—¶é—´: ${T(k)}`:U=`æ—¶é—´èŒƒå›´: ${T(k)} - ${T(I)}`}return{id:h,name:g.summary||"ä¸»é¢˜ç°‡",summary:U,nodeCount:j,linkCount:H,avgWeight:C,data:g}}).sort((h,g)=>g.nodeCount-h.nodeCount),n.currentId=null,n.pathNodes=[],n.pathLinks=new Set,n.derived={},n.fadedNodes=new Set,n.isInClusterMode=!1,n.currentClusterId=null,$(),ie()}),(t,e)=>(p(),m("div",ot,[a("div",st,[e[6]||(e[6]=a("h3",null,"ğŸ“‹ è·¯å¾„è®°å½•",-1)),a("button",{class:"clear-btn",onClick:qe},"ğŸ”„ å›åˆ°åˆå§‹ç•Œé¢"),a("ul",null,[(p(!0),m(ce,null,de(se.value,(o,s)=>(p(),m("li",{key:o,class:tt({current:o===me.value}),onClick:r=>x(o),title:be(o)},[a("span",rt,[s>0?(p(),m("span",it)):F("",!0),ue(" "+w(be(o)),1)]),a("div",at,[a("button",{class:"act-btn",onClick:Ie(r=>x(o),["stop"])},"ğŸ”",8,lt),se.value.length>1&&s<se.value.length-1?(p(),m("button",{key:0,class:"act-btn",onClick:Ie(r=>Pe(s),["stop"])}," â†©ï¸ ",8,ct)):F("",!0)])],10,nt))),128))])]),a("div",dt,[n.isInClusterMode?(p(),m("div",It,[a("div",Tt,[a("h2",null,w(Ve.value),1)]),a("div",{ref_key:"chartRef",ref:ee,class:"chart"},null,512)])):(p(),m("div",ut,[a("div",ht,[e[11]||(e[11]=a("div",{class:"header-title"},[a("h2",null,"AIæ–°é—»å…³ç³»ç½‘ç»œå›¾è°±"),a("p",{class:"subtitle"},"æ¢ç´¢æ–°é—»ä¹‹é—´çš„å¤æ‚å…³è”ç½‘ç»œ")],-1)),a("div",ft,[a("div",gt,[a("div",mt,[Z(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>q.value=o),onInput:we,placeholder:"æœç´¢ä¸»é¢˜...",class:"search-input"},null,544),[[Je,q.value]])]),a("div",pt,[a("label",vt,[Z(a("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=o=>te.value=o),onChange:we},null,544),[[et,te.value]]),e[7]||(e[7]=a("span",{class:"toggle-slider"},null,-1)),e[8]||(e[8]=a("span",{class:"toggle-text"},"å®½æ¾åŒ¹é…",-1)),a("span",{class:"tooltip",onMouseenter:e[2]||(e[2]=o=>Le(o,"å¼€å¯åå¯æ¨¡ç³ŠåŒ¹é…ç›¸ä¼¼ä¸»é¢˜ç°‡")),onMouseleave:De},"â”",32)])])]),a("div",wt,[Z(a("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>R.value=o),class:"filter-select"},[...e[9]||(e[9]=[$e('<option value="all" data-v-33830506>å…¨éƒ¨æ—¶é—´</option><option value="week" data-v-33830506>æœ¬å‘¨</option><option value="10days" data-v-33830506>10å¤©å†…</option><option value="month" data-v-33830506>æœ¬æœˆ</option><option value="3months" data-v-33830506>è¿‘ä¸‰ä¸ªæœˆ</option>',5)])],512),[[Me,R.value]]),Z(a("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>O.value=o),class:"sort-select"},[...e[10]||(e[10]=[$e('<option value="default" data-v-33830506>é»˜è®¤æ’åº</option><option value="timeDesc" data-v-33830506>æ—¶é—´ä»æ–°åˆ°æ—§</option><option value="timeAsc" data-v-33830506>æ—¶é—´ä»æ—§åˆ°æ–°</option><option value="nodesDesc" data-v-33830506>èŠ‚ç‚¹æ•°ä»å¤šåˆ°å°‘</option><option value="nodesAsc" data-v-33830506>èŠ‚ç‚¹æ•°ä»å°‘åˆ°å¤š</option>',5)])],512),[[Me,O.value]])])])]),a("div",yt,[(p(!0),m(ce,null,de(_e.value,o=>(p(),m("div",{key:o.id,class:"cluster-item",onClick:s=>ne(o.data,o.id),onMouseover:s=>S.value=o.id,onMouseout:e[5]||(e[5]=s=>S.value=null)},[a("div",_t,[a("h3",bt,w(o.name),1),a("span",St,w(o.nodeCount)+" ä¸ªèŠ‚ç‚¹",1)]),a("p",Nt,w(o.summary),1),a("div",kt,[a("span",Mt,w(o.linkCount)+" æ¡å…³è”",1),a("span",$t,"å¹³å‡æƒé‡: "+w(o.avgWeight),1)])],40,Ct))),128))]),_e.value.length===0?(p(),m("div",xt," æœªæ‰¾åˆ°åŒ¹é…çš„ä¸»é¢˜ç°‡ ")):F("",!0)]))]),a("div",Lt,[a("div",Dt,[e[15]||(e[15]=a("h3",null,"ğŸ“„ èŠ‚ç‚¹ä¿¡æ¯",-1)),N.value?(p(),m("div",zt,[a("h4",null,[N.value.url?(p(),m("a",{key:0,href:N.value.url,target:"_blank",rel:"noopener"}," ğŸ“° "+w(N.value.title),9,Wt)):(p(),m("span",Et,"ğŸ“° "+w(N.value.title),1))]),a("p",Ft,"ğŸ•’ "+w(N.value.time||"æœªçŸ¥"),1),n.isInClusterMode||!N.value.isSuper?(p(),m("p",Rt,w(N.value.summary),1)):F("",!0),!n.isInClusterMode&&N.value.isSuper?(p(),m("div",Ot,[a("p",null,[e[12]||(e[12]=a("strong",null,"èŠ‚ç‚¹æ•°é‡:",-1)),ue(" "+w(N.value.summary?.match(/(\d+) ä¸ªç›¸å…³èŠ‚ç‚¹/)?.[1]||"æœªçŸ¥"),1)]),a("p",null,[e[13]||(e[13]=a("strong",null,"å…³è”æ•°é‡:",-1)),ue(" "+w(N.value.summary?.match(/(\d+) æ¡å…³è”/)?.[1]||"æœªçŸ¥"),1)])])):F("",!0)])):(p(),m("div",Bt,[...e[14]||(e[14]=[a("p",null,"ğŸ‘† è¯·é€‰æ‹©èŠ‚ç‚¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯",-1)])]))]),a("div",At,[e[17]||(e[17]=a("h3",null,"ğŸ”— ç›¸å…³èŠ‚ç‚¹",-1)),a("ul",null,[(p(!0),m(ce,null,de(je.value,o=>(p(),m("li",{key:o.id,onClick:s=>x(o.id),class:"related-item"},[a("div",jt,[o.url?(p(),m("a",{key:0,href:o.url,target:"_blank",rel:"noopener",class:"related-title"},w(o.title),9,Ht)):(p(),m("span",Ut,w(o.title),1))]),a("div",Gt,[a("div",Yt,[a("div",{class:"weight-fill",style:xe({width:Math.min(o.weight*25,100)+"%"})},null,4)]),a("small",Pt,"ç›¸å…³åº¦ï¼š"+w(o.weight),1)])],8,Vt))),128))]),a("div",qt,[e[16]||(e[16]=a("h4",null,"ğŸ—ºï¸ å…³è”å›¾è°±",-1)),a("div",{ref_key:"miniChartRef",ref:fe,class:"mini-chart"},null,512)])])]),K.value?(p(),m("div",{key:0,class:"hover-tip",style:xe({left:oe.value.x+"px",top:oe.value.y+"px"})},w(K.value),5)):F("",!0)]))}},Jt=Qe(Kt,[["__scopeId","data-v-33830506"]]);export{Jt as default};
